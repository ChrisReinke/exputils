#!/bin/bash

MACHINE=$EU_PRJ_INRIA_DEFAULT_MACHINE

# path to experiments on the local host
LOCAL_EXPERIMENTS_DIR=$EU_PRJ_LOCAL_EXPERIMENTS_PATH
# path to the experiments directory on the target host
EXTERNAL_EXPERIMENTS_DIR=$EU_PRJ_INRIA_EXPERIMENTS_PATH

# replace the path to the experiments on local host with the one at the target host
LOCAL_SCRIPT_PATH=`pwd`
EXTERNAL_SCRIPT_PATH=`echo $LOCAL_SCRIPT_PATH | sed "s+${LOCAL_EXPERIMENTS_DIR}+${EXTERNAL_EXPERIMENTS_DIR}+g"`

# arguments for the external eu_inria_run_experiments call
ARGUMENTS=""

# handle arguments
while getopts ":m:r" arg; do
  case $arg in
    m) MACHINE=$OPTARG;;
    r) ARGUMENTS="$ARGUMENTS -r";;
  esac
done

# got to the current experiment directory on the target host and start the "run_experiments.sh" script
ssh $MACHINE "cd ${EXTERNAL_SCRIPT_PATH};  nohup  eu_inria_run_experiments $ARGUMENTS > inria_run_experiments_out.log 2> inria_run_experiments_err.log < /dev/null &"