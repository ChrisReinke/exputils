#!/usr/bin/env bash

###############
# Parameters
# path to experiments on the local host
LOCAL_EXPERIMENTS_DIR=$EU_PRJ_LOCAL_EXPERIMENTS_PATH
# path to the experiments directory on the target host
EXTERNAL_EXPERIMENTS_DIR=$EU_PRJ_INRIA_EXPERIMENTS_PATH
INRIA_ACCESS_MACHINE=$EU_PRJ_INRIA_DEFAULT_MACHINE
###############
# Execution

ARGUMENTS=
while getopts ":a:m:c:w:n:r" arg; do
  case $arg in
    a) INRIA_ACCESS_MACHINE=$OPTARG;;
    m) ARGUMENTS="$ARGUMENTS -m $OPTARG";;
    c) ARGUMENTS="$ARGUMENTS -c $OPTARG";;
    w) ARGUMENTS="$ARGUMENTS -w $OPTARG";;
    n) ARGUMENTS="$ARGUMENTS -n $OPTARG";;
    r) ARGUMENTS="$ARGUMENTS -r";;
  esac
done


# replace the path to the experiments on local host with the one at the target host
LOCAL_SCRIPT_PATH=`pwd`
EXTERNAL_SCRIPT_PATH=`echo $LOCAL_SCRIPT_PATH | sed "s+${LOCAL_EXPERIMENTS_DIR}+${EXTERNAL_EXPERIMENTS_DIR}+g"`

# got to the current experiment directory on the target host and start the "run_experiments.sh" script
#ssh $INRIA_ACCESS_MACHINE "source eu_activate $EU_ACTIVE_PRJ; cd ${EXTERNAL_SCRIPT_PATH};  nohup  eu_ic_run_experiments $ARGUMENTS > inria_run_experiments_out.log 2> inria_run_experiments_err.log < /dev/null &"
ssh $INRIA_ACCESS_MACHINE "source eu_activate $EU_ACTIVE_PRJ; cd ${EXTERNAL_SCRIPT_PATH}; eu_ic_run_experiments $ARGUMENTS"


