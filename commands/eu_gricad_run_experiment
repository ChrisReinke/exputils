#!/usr/bin/env bash

##########################
# Parameters

CONDA_ENV=$EU_PRJ_GRICAD_DEFAULT_CONDA_ENV
NUM_PROCESSES=$EU_PRJ_GRICAD_DEFAULT_NUM_PROCESSES
RUN_REPETITION_SCRIPT=$EU_PRJ_DEFAULT_RUN_REPETITION_SCRIPT
IS_RERUN=False

##########################
# Execution

while getopts ":n:r" arg; do
  case $arg in
    n) NUM_PROCESSES=$OPTARG;;
    r) IS_RERUN=True;;
  esac
done

echo "Run experiment ..."

eu_gricad_python -c "import exputils

exputils.manage.start_experiments(
  directory='.',
  start_scripts='$RUN_REPETITION_SCRIPT',
  parallel=$NUM_PROCESSES,
  is_chdir=True,
  verbose=False,
  is_rerun=$IS_RERUN)"

echo "Finished."
